name: Java to Bedrock (Manual)
on:
  workflow_dispatch:
    inputs:
      java_pack_url:
        description: 'Java 资源包直链 (例如 4.zip 的 Raw 链接)'
        required: true
        default: 'https://github.com/AfenLeoht/farmerspack/raw/main/4.zip'

jobs:
  convert-pack:
    runs-on: ubuntu-latest
    permissions: 
      contents: read
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 17

      - name: Update APT and Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y moreutils zip imagemagick uuid-runtime
          yarn global add spritesheet-js

      - name: Run Converter
        env: 
          PACK_URL: ${{ github.event.inputs.java_pack_url }}
        run: |
          mkdir -p staging
          cp converter.sh staging/
          cd staging
          chmod +x converter.sh
          # 下载资源包
          echo "Downloading: $PACK_URL"
          curl -#L -o input_pack.zip "$PACK_URL"
          # 运行你修改过的 converter.sh
          ./converter.sh input_pack.zip -w "false" -u "true"

      - name: Upload Results
        uses: actions/upload-artifact@v4
        with:
          name: Converted_Pack_Files
          path: |
            staging/target/geyser_mappings.json
            staging/target/packaged/geyser_resources.mcpack
            staging/target/packaged/geyser_addon.mcaddon
